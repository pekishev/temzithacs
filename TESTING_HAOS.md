# Инструкция по тестированию интеграции Temzit на Home Assistant OS (HAOS)

## Подготовка

### 1. Установка через HACS (рекомендуется)

1. Убедитесь, что HACS установлен в вашей системе Home Assistant
2. Перейдите в **HACS** → **Integrations**
3. Нажмите на три точки (⋮) в правом верхнем углу
4. Выберите **Custom repositories**
5. Добавьте репозиторий:
   - **Repository**: `https://github.com/pekishev/temzithacs`
   - **Category**: `Integration`
6. Нажмите **Add**
7. Перезагрузите Home Assistant
8. Перейдите в **HACS** → **Integrations**
9. Найдите "Temzit heat pump integration" и нажмите **Download**
10. Перезагрузите Home Assistant еще раз

### 2. Ручная установка (для разработки)

Если вы разрабатываете интеграцию локально:

1. Подключитесь к Home Assistant OS через SSH (добавьте SSH add-on если нужно)
2. Скопируйте папку `custom_components/temzit` в `/config/custom_components/` на HAOS
3. Убедитесь, что права доступа правильные:
   ```bash
   chmod -R 755 /config/custom_components/temzit
   ```
4. Перезагрузите Home Assistant

## Настройка интеграции

1. Перейдите в **Настройки** → **Устройства и службы**
2. Нажмите **Добавить интеграцию** (кнопка в правом нижнем углу)
3. Найдите "Temzit heat pumps integration"
4. Введите IP-адрес вашего теплового насоса в локальной сети
5. Нажмите **Отправить**

## Проверка работы

### 1. Проверка логов

1. Перейдите в **Настройки** → **Система** → **Журналы**
2. Найдите записи с префиксом `temzit`
3. Убедитесь, что нет ошибок подключения

Или через SSH:
```bash
tail -f /config/home-assistant.log | grep temzit
```

### 2. Проверка сущностей (entities)

После успешной настройки должны появиться следующие сущности:

**Сенсоры:**
- `sensor.temzit_heat_pump_integration_temperatura_v_dome` - Температура в доме
- `sensor.temzit_heat_pump_integration_temperatura_na_ulice` - Температура на улице
- `sensor.temzit_heat_pump_integration_temperatura_gvs` - Температура ГВС
- `sensor.temzit_heat_pump_integration_podacha` - Подача
- `sensor.temzit_heat_pump_integration_obratka` - Обратка
- `sensor.temzit_heat_pump_integration_potreblenie_elektrichestva` - Потребление электричества
- `sensor.temzit_heat_pump_integration_moshchnost_nagreva` - Мощность нагрева
- `sensor.temzit_heat_pump_integration_protok` - Проток

**Климат:**
- `climate.temzit_heat_pump_integration_obogrev_doma` - Обогрев дома

**Водонагреватели:**
- `water_heater.temzit_heat_pump_integration_goriachaia_voda` - Горячая вода
- `water_heater.temzit_heat_pump_integration_obogrev_doma` - Обогрев дома

### 3. Проверка обновления данных

1. Перейдите в **Настройки** → **Устройства и службы**
2. Найдите ваше устройство "Temzit heat pump integration"
3. Откройте его и проверьте, что все сущности обновляются каждые 30 секунд
4. Значения должны соответствовать текущему состоянию теплового насоса

### 4. Проверка управления (если реализовано)

**Примечание:** Методы управления температурой пока не реализованы в API (возвращают `NotImplementedError`). Для их реализации необходимо знать протокол записи команд теплового насоса.

Когда методы будут реализованы:
- Попробуйте изменить целевую температуру через интерфейс климата
- Проверьте, что изменения применяются на устройстве
- Убедитесь, что состояние обновляется после изменения

## Отладка проблем

### Проблема: "Unable to connect to the heat pump"

**Возможные причины:**
1. Неправильный IP-адрес
2. Тепловой насос не в той же сети, что и Home Assistant
3. Порт 333 заблокирован файрволом
4. Тепловой насос выключен или недоступен

**Решение:**
1. Проверьте IP-адрес через веб-интерфейс теплового насоса (если есть)
2. Проверьте доступность через ping:
   ```bash
   ping <IP-адрес>
   ```
3. Проверьте доступность порта:
   ```bash
   telnet <IP-адрес> 333
   ```
   или
   ```bash
   nc -zv <IP-адрес> 333
   ```

### Проблема: "Empty response from device"

**Возможные причины:**
1. Тепловой насос не отвечает на команду `0x30 0x00`
2. Таймаут соединения слишком короткий

**Решение:**
1. Проверьте логи для более детальной информации
2. Убедитесь, что тепловой насос поддерживает протокол на порту 333

### Проблема: Сущности не обновляются

**Возможные причины:**
1. Coordinator не может получить данные
2. Ошибки в обработке данных

**Решение:**
1. Проверьте логи на наличие ошибок
2. Перезагрузите интеграцию:
   - **Настройки** → **Устройства и службы** → Найдите интеграцию → **Перезагрузить**
3. Если не помогло, удалите и добавьте интеграцию заново

## Проверка через Developer Tools

1. Перейдите в **Настройки** → **Инструменты разработчика**
2. Во вкладке **Состояния** найдите сущности с префиксом `temzit`
3. Проверьте их атрибуты и значения
4. Во вкладке **Службы** можно вызвать методы обновления вручную

## Проверка производительности

Интеграция опрашивает тепловой насос каждые 30 секунд. Это можно изменить в `coordinator.py`:

```python
update_interval=timedelta(seconds=30),  # Измените на нужное значение
```

**Рекомендации:**
- Не устанавливайте интервал меньше 10 секунд (может перегрузить устройство)
- Для стабильной работы рекомендуется 30-60 секунд

## Дополнительная информация

- Версия интеграции: 2024.1.1
- Минимальная версия Home Assistant: 2023.8.0
- Протокол: TCP на порту 333
- Класс IoT: local_polling (локальное опрашивание)

## Поддержка

Если возникли проблемы:
1. Проверьте логи Home Assistant
2. Убедитесь, что версия Home Assistant соответствует требованиям
3. Проверьте, что тепловой насос доступен в сети
4. Создайте issue в репозитории GitHub с описанием проблемы и логами

